{
  "hash": "261f34006f267ef2db741e79c1a166d6",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Statistique descriptive bivariée\"\nformat:\n  html:\n    theme: \n      light: cosmo\n    code-fold: false\n    css : \"styles.css\"\njupyter: python3\n---\n\n\n Le but de ce projet est de s'entraîner à explorer les liaisons entre deux variables.\n\n### - Importations de bibliothèques\n\n::: {#d013470a .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.linear_model import LinearRegression \n```\n:::\n\n\n## 1 - Régression linéaire à la main\n\nLe jeu de données gag.csv contient l'âge (en année) et une mesure de concentration en glycosaminoglycane (gag) dans l'urine pour une population d'enfants de 0 à 17 ans.\n\n### 1 - Importer le jeu de donnée\n\n::: {#ee43de8e .cell execution_count=2}\n``` {.python .cell-code}\ngag = pd.read_csv('gag.csv')\n```\n:::\n\n\n### 2 - Combien y a-t-il d'individus dans ce jeu de données ?\n\nDimensions du data frame\n\n::: {#a63facf1 .cell execution_count=3}\n``` {.python .cell-code}\ngag.shape\n```\n\n::: {.cell-output .cell-output-display execution_count=63}\n```\n(314, 2)\n```\n:::\n:::\n\n\nIl y a 314 individus (lignes).\n\n### 3 - Quel est l'âge moyen des individus ? Quel est leur âge médian ?\n\n::: {#bce9c24c .cell execution_count=4}\n``` {.python .cell-code}\ngag.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=64}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Age</th>\n      <th>GAG</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>314.000000</td>\n      <td>314.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>8.550955</td>\n      <td>50.216572</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>5.158722</td>\n      <td>29.043797</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>0.000000</td>\n      <td>0.150561</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>4.000000</td>\n      <td>22.998461</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>9.000000</td>\n      <td>49.190105</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>13.000000</td>\n      <td>74.712759</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>17.000000</td>\n      <td>99.827356</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nL'âge moyen est 5.28 ans, l'âge médian 4.10 ans.\n\n### 3 - Tracer la boîte à moustaches de l'âge.\n\n::: {#8dd96f18 .cell execution_count=5}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.boxplot(gag.Age)\nfig.suptitle('Boxplot des âges')\n```\n\n::: {.cell-output .cell-output-display execution_count=65}\n```\nText(0.5, 0.98, 'Boxplot des âges')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-6-output-2.png){width=579 height=459}\n:::\n:::\n\n\n### 4 - Quel est la concentration moyenne en gag ? Quel est la concentration médiane ?\n\n::: {#664bdf9e .cell execution_count=6}\n``` {.python .cell-code}\ngag.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=66}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Age</th>\n      <th>GAG</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>314.000000</td>\n      <td>314.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>8.550955</td>\n      <td>50.216572</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>5.158722</td>\n      <td>29.043797</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>0.000000</td>\n      <td>0.150561</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>4.000000</td>\n      <td>22.998461</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>9.000000</td>\n      <td>49.190105</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>13.000000</td>\n      <td>74.712759</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>17.000000</td>\n      <td>99.827356</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nLa concentration moyenne est de 13.17, la concentration médiane de 10.6.\n\n### 5 - Tracer la boîte à moustaches de la concentration de gag.\n\n::: {#a8e746cb .cell execution_count=7}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.boxplot(gag.GAG)\nfig.suptitle('Boxplot de la concentration de gag')\n```\n\n::: {.cell-output .cell-output-display execution_count=67}\n```\nText(0.5, 0.98, 'Boxplot de la concentration de gag')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-8-output-2.png){width=575 height=459}\n:::\n:::\n\n\n### 6 - Tracer le nuage de points de la concentration de gag en fonction de l'âge.\n\n::: {#22912660 .cell execution_count=8}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.scatter(gag.Age, gag.GAG, edgecolors='k')\nax.set_xlabel('âge')\nax.set_ylabel('concentration de gag')\n```\n\n::: {.cell-output .cell-output-display execution_count=68}\n```\nText(0, 0.5, 'concentration de gag')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-9-output-2.png){width=598 height=430}\n:::\n:::\n\n\n### 7 - Semble-t-il y avoir une relation linéaire entre les variables ?\n\nIl semble y avoir une liaison décroissante forte, mais pas vraiment linéaire.\n\n### 8 - Calculer les coefficients de la droite de régression de la concentration de gag en fonction de l'âge.\n\nOn rappelle que la droite de régression de $y$ par rapport à $x$ est la droite d'équation $y = \\beta_0 +\\beta_1 x$ avec\n\n$$\n   \\beta_0 = \\bar{y}-\\beta_1 \\bar{x} \\text{,} \\quad \\beta_1 = \\frac{C(x,y)}{V(x)}.\n$$\n\n::: {#68cf69e7 .cell execution_count=9}\n``` {.python .cell-code}\nC = np.cov(gag.Age, gag.GAG)\nb1 = C[0][1]/C[0][0]\nb0 = np.mean(gag.GAG)-b1*np.mean(gag.Age)\nprint(b0,b1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n51.76076990236237 -0.18058772995835704\n```\n:::\n:::\n\n\n### 9 - Ajoutez la droite de régression sur votre nuage de points.\n\n::: {#629cfe60 .cell execution_count=10}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.scatter(gag.Age, gag.GAG, edgecolors='k')\nax.plot(gag.Age,b0+b1*gag.Age, color='r')\nax.set_xlabel('âge')\nax.set_ylabel('concentration de gag')\n```\n\n::: {.cell-output .cell-output-display execution_count=70}\n```\nText(0, 0.5, 'concentration de gag')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-11-output-2.png){width=598 height=430}\n:::\n:::\n\n\n### 10 - L'ajustement linéaire est-il visuellement satisfaisant ?\n\nIl semble acceptable pour les valeurs loin de 0, mais très mauvais pour les toutes petites valeurs.\n\n### 11 - Calculez le coefficient de détermination\n\n$$\n R^2 = \\frac{SC_reg}{SC_tot} = \\frac{variation expliquée}{variation totale}.\n $$ On rappelle que pour la régression de $y$ par rapport à $x$, on a $$\nSC_{tot}=\\sum_{k=1}^n(y_k-\\overline y)^2=nV(y),\\quad SC_{reg}=\\sum_{k=1}^n(\\hat y_k-\\overline y)^2,\n$$ avec $\\hat y_k = \\beta_0 + \\beta_1 x_k$. On rappelle également que le coefficient de détermination est égal au coefficient de corrélation au carré.\n\n::: {#4cbbc2c0 .cell execution_count=11}\n``` {.python .cell-code}\ngag.corr()\n```\n\n::: {.cell-output .cell-output-display execution_count=71}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Age</th>\n      <th>GAG</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Age</th>\n      <td>1.000000</td>\n      <td>-0.032076</td>\n    </tr>\n    <tr>\n      <th>GAG</th>\n      <td>-0.032076</td>\n      <td>1.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#753a8e76 .cell execution_count=12}\n``` {.python .cell-code}\ngag.corr()**2\n```\n\n::: {.cell-output .cell-output-display execution_count=72}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Age</th>\n      <th>GAG</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Age</th>\n      <td>1.000000</td>\n      <td>0.001029</td>\n    </tr>\n    <tr>\n      <th>GAG</th>\n      <td>0.001029</td>\n      <td>1.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nOn trouve qu'un peu moins de 50% de la variabilité de la concentration en gag est expliquée par la régression.\n\nAvec un calcul direct\n\n::: {#43d9df06 .cell execution_count=13}\n``` {.python .cell-code}\n# somme des carres totale \nSCtot = len(gag.GAG)*np.var(gag.GAG)\n# residus\ngagchap = b0+b1*gag.Age\n# somme des carres expliquee\nSCreg = sum((gagchap-np.mean(gag.GAG))**2)\n# R2\nR2 = SCreg/SCtot\nprint(R2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.0010288544093309808\n```\n:::\n:::\n\n\nOn trouve bien sûr la même chose.\n\n### 12 - L'ajustement linéaire est-il satisfaisant ?\n\nNon car moins de 50% de la variabilité est expliquée par la régression.\n\n### 13 - Utiliser la droite de régression pour prédire la concentration de gag à 18 ans. Qu'en pensez-vous ?\n\nOn prédit une valeur négative, ce qui est incohérent. Ceci est dû au mauvais ajustement de la droite de régression.\n\n## 2 - Régression non linéaire à la main\n\nPour améliorer la qualité de l'ajustement, on peut faire une transformation des données. La visualisation du nuage de points aide à deviner une forme adaptée.\n\nOn continue à travailler sur le jeu de données gag.csv.\n\n### 1 - Créer un vecteur lgag égal au logarithme de la concentration en gag.\n\n::: {#af3e3649 .cell execution_count=14}\n``` {.python .cell-code}\nlgag = np.log(gag.GAG)\n```\n:::\n\n\n### 2 - Tracer le nuage de points du logarithme de la concentration de gag en fonction de l'âge.\n\n::: {#d5b9b4d2 .cell execution_count=15}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.scatter(gag.Age, lgag, edgecolors='k')\nax.set_xlabel('âge')\nax.set_ylabel('log de la concentration de gag')\n```\n\n::: {.cell-output .cell-output-display execution_count=75}\n```\nText(0, 0.5, 'log de la concentration de gag')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-16-output-2.png){width=592 height=430}\n:::\n:::\n\n\n### 3 - Calculer les coefficients de la droite de régression du logarithme de la concentration de gag en fonction de l'âge.\n\n::: {#d2fadee7 .cell execution_count=16}\n``` {.python .cell-code}\nC = np.cov(gag.Age, lgag)\nb1 = C[0][1]/C[0][0]\nb0 = np.mean(lgag)-b1*np.mean(gag.Age)\nprint(b0,b1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n3.7389692885116625 -0.01485877679182514\n```\n:::\n:::\n\n\n### 4 - Ajoutez la droite de régression sur votre nuage de points.\n\n::: {#7604c393 .cell execution_count=17}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.scatter(gag.Age, lgag, edgecolors='k')\nax.plot(gag.Age,b0+b1*gag.Age, color='r')\nax.set_xlabel('âge')\nax.set_ylabel('log de la concentration de gag')\n```\n\n::: {.cell-output .cell-output-display execution_count=77}\n```\nText(0, 0.5, 'log de la concentration de gag')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-18-output-2.png){width=592 height=430}\n:::\n:::\n\n\n### 5 - Evaluer la qualité de l'ajustement linéaire.\n\nCalculons le coefficient de détermination\n\n::: {#b751c098 .cell execution_count=18}\n``` {.python .cell-code}\n# somme des carres totale \nSCtot = len(lgag)*np.var(lgag)\n# residus\ngagchap = b0+b1*gag.Age\n# somme des carres expliquee\nSCreg = sum((gagchap-np.mean(lgag))**2)\n# R2\nR2 = SCreg/SCtot\nprint(R2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.0059852483371809475\n```\n:::\n:::\n\n\nOn trouve maintenant que 72% de la variabilité est expliquée par la régression. C'est beaucoup mieux.\n\n### 6 - Quelle est alors la relation entre l'âge et le logarithme de la concentration de gag fournie par cette droite ? La représenter graphiquement.\n\nOn a $\\log(\\text{gag})=\\beta_0+\\beta_1 \\text{age}$ ce qui est équivalent à $\\text{gag}=\\exp(\\beta_0+\\beta_1 \\text{age})$.\n\n::: {#6fd3f497 .cell execution_count=19}\n``` {.python .cell-code}\nfig, ax=plt.subplots()\nax.scatter(gag.Age, gag.GAG, edgecolors='k')\nax.plot(gag.Age,np.exp(b0+b1*gag.Age), color='r')\nax.set_xlabel('âge')\nax.set_ylabel('concentration de gag')\n```\n\n::: {.cell-output .cell-output-display execution_count=79}\n```\nText(0, 0.5, 'concentration de gag')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](analyse-bivarie_files/figure-html/cell-20-output-2.png){width=598 height=430}\n:::\n:::\n\n\n### 7 - Utiliser cette relation pour prédire la concentration de gag à 18 ans.\n\n::: {#f091ecdb .cell execution_count=20}\n``` {.python .cell-code}\nnp.exp(b0+b1*18)\n```\n\n::: {.cell-output .cell-output-display execution_count=80}\n```\nnp.float64(32.185347624152215)\n```\n:::\n:::\n\n\n",
    "supporting": [
      "analyse-bivarie_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}